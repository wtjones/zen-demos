#include "rasgl/core/maths_tables.h"
#include <stdio.h>

RasFixed z_scale_table[RAS_Z_SCALE_STEPS + 1];
RasFixed z_scale_table_shift[RAS_Z_SCALE_STEPS + 1];

void core_init_z_scale_table()
{
    const RasFixed z_min_fp = RAS_Z_SCALE_FIXED_MIN;
    const RasFixed z_max_fp = RAS_Z_SCALE_FIXED_MAX;
    for (size_t i = 0; i < RAS_Z_SCALE_STEPS; i++) {

        int32_t z = RAS_Z_SCALE_FIXED_MIN + (int32_t)((int64_t)i * (z_max_fp - z_min_fp) / (RAS_Z_SCALE_STEPS - 1));

        // Store 1/z in fixed 16.16
        z_scale_table[i] = div_fixed_16_16_by_fixed_16_16(RAS_FIXED_ONE, z);
    }
}

void core_init_z_scale_table_shift()
{
    const RasFixed znear_fp = RAS_FIXED_TENTH; // e.g. 0.1 in 16.16

    for (size_t i = 0; i < RAS_Z_SCALE_STEPS; i++) {

        // Map w to input w used in the perspective divide.
        // This avoids additional math to compute the index.
        RasFixed w = (RasFixed)(i << RAS_Z_SCALE_W_SHIFT);

        if (w < znear_fp)
            w = znear_fp;

        // Store 1/w in fixed 16.16
        z_scale_table_shift[i] = div_fixed_16_16_by_fixed_16_16(RAS_FIXED_ONE, w);
    }
}

void core_init_maths_tables()
{
    core_init_z_scale_table();
    core_init_z_scale_table_shift();
}

RasFixed cos_table[360] = {
    65536,
    65526,
    65496,
    65446,
    65376,
    65286,
    65176,
    65047,
    64898,
    64729,
    64540,
    64331,
    64103,
    63856,
    63589,
    63302,
    62997,
    62672,
    62328,
    61965,
    61583,
    61183,
    60763,
    60326,
    59870,
    59395,
    58903,
    58393,
    57864,
    57319,
    56755,
    56175,
    55577,
    54963,
    54331,
    53683,
    53019,
    52339,
    51643,
    50931,
    50203,
    49460,
    48702,
    47929,
    47142,
    46340,
    45525,
    44695,
    43852,
    42995,
    42125,
    41243,
    40347,
    39440,
    38521,
    37589,
    36647,
    35693,
    34728,
    33753,
    32768,
    31772,
    30767,
    29752,
    28729,
    27696,
    26655,
    25606,
    24550,
    23486,
    22414,
    21336,
    20251,
    19160,
    18064,
    16961,
    15854,
    14742,
    13625,
    12504,
    11380,
    10252,
    9120,
    7986,
    6850,
    5711,
    4571,
    3429,
    2287,
    1143,
    0,
    -1143,
    -2287,
    -3429,
    -4571,
    -5711,
    -6850,
    -7986,
    -9120,
    -10252,
    -11380,
    -12504,
    -13625,
    -14742,
    -15854,
    -16961,
    -18064,
    -19160,
    -20251,
    -21336,
    -22414,
    -23486,
    -24550,
    -25606,
    -26655,
    -27696,
    -28729,
    -29752,
    -30767,
    -31772,
    -32768,
    -33753,
    -34728,
    -35693,
    -36647,
    -37589,
    -38521,
    -39440,
    -40347,
    -41243,
    -42125,
    -42995,
    -43852,
    -44695,
    -45525,
    -46340,
    -47142,
    -47929,
    -48702,
    -49460,
    -50203,
    -50931,
    -51643,
    -52339,
    -53019,
    -53683,
    -54331,
    -54963,
    -55577,
    -56175,
    -56755,
    -57319,
    -57864,
    -58393,
    -58903,
    -59395,
    -59870,
    -60326,
    -60763,
    -61183,
    -61583,
    -61965,
    -62328,
    -62672,
    -62997,
    -63302,
    -63589,
    -63856,
    -64103,
    -64331,
    -64540,
    -64729,
    -64898,
    -65047,
    -65176,
    -65286,
    -65376,
    -65446,
    -65496,
    -65526,
    -65536,
    -65526,
    -65496,
    -65446,
    -65376,
    -65286,
    -65176,
    -65047,
    -64898,
    -64729,
    -64540,
    -64331,
    -64103,
    -63856,
    -63589,
    -63302,
    -62997,
    -62672,
    -62328,
    -61965,
    -61583,
    -61183,
    -60763,
    -60326,
    -59870,
    -59395,
    -58903,
    -58393,
    -57864,
    -57319,
    -56755,
    -56175,
    -55577,
    -54963,
    -54331,
    -53683,
    -53019,
    -52339,
    -51643,
    -50931,
    -50203,
    -49460,
    -48702,
    -47929,
    -47142,
    -46340,
    -45525,
    -44695,
    -43852,
    -42995,
    -42125,
    -41243,
    -40347,
    -39440,
    -38521,
    -37589,
    -36647,
    -35693,
    -34728,
    -33753,
    -32768,
    -31772,
    -30767,
    -29752,
    -28729,
    -27696,
    -26655,
    -25606,
    -24550,
    -23486,
    -22414,
    -21336,
    -20251,
    -19160,
    -18064,
    -16961,
    -15854,
    -14742,
    -13625,
    -12504,
    -11380,
    -10252,
    -9120,
    -7986,
    -6850,
    -5711,
    -4571,
    -3429,
    -2287,
    -1143,
    0,
    1143,
    2287,
    3429,
    4571,
    5711,
    6850,
    7986,
    9120,
    10252,
    11380,
    12504,
    13625,
    14742,
    15854,
    16961,
    18064,
    19160,
    20251,
    21336,
    22414,
    23486,
    24550,
    25606,
    26655,
    27696,
    28729,
    29752,
    30767,
    31772,
    32768,
    33753,
    34728,
    35693,
    36647,
    37589,
    38521,
    39440,
    40347,
    41243,
    42125,
    42995,
    43852,
    44695,
    45525,
    46340,
    47142,
    47929,
    48702,
    49460,
    50203,
    50931,
    51643,
    52339,
    53019,
    53683,
    54331,
    54963,
    55577,
    56175,
    56755,
    57319,
    57864,
    58393,
    58903,
    59395,
    59870,
    60326,
    60763,
    61183,
    61583,
    61965,
    62328,
    62672,
    62997,
    63302,
    63589,
    63856,
    64103,
    64331,
    64540,
    64729,
    64898,
    65047,
    65176,
    65286,
    65376,
    65446,
    65496,
    65526
};
RasFixed sin_table[360] = {
    0,
    -1143,
    -2287,
    -3429,
    -4571,
    -5711,
    -6850,
    -7986,
    -9120,
    -10252,
    -11380,
    -12504,
    -13625,
    -14742,
    -15854,
    -16961,
    -18064,
    -19160,
    -20251,
    -21336,
    -22414,
    -23486,
    -24550,
    -25606,
    -26655,
    -27696,
    -28729,
    -29752,
    -30767,
    -31772,
    -32768,
    -33753,
    -34728,
    -35693,
    -36647,
    -37589,
    -38521,
    -39440,
    -40347,
    -41243,
    -42125,
    -42995,
    -43852,
    -44695,
    -45525,
    -46340,
    -47142,
    -47929,
    -48702,
    -49460,
    -50203,
    -50931,
    -51643,
    -52339,
    -53019,
    -53683,
    -54331,
    -54963,
    -55577,
    -56175,
    -56755,
    -57319,
    -57864,
    -58393,
    -58903,
    -59395,
    -59870,
    -60326,
    -60763,
    -61183,
    -61583,
    -61965,
    -62328,
    -62672,
    -62997,
    -63302,
    -63589,
    -63856,
    -64103,
    -64331,
    -64540,
    -64729,
    -64898,
    -65047,
    -65176,
    -65286,
    -65376,
    -65446,
    -65496,
    -65526,
    -65536,
    -65526,
    -65496,
    -65446,
    -65376,
    -65286,
    -65176,
    -65047,
    -64898,
    -64729,
    -64540,
    -64331,
    -64103,
    -63856,
    -63589,
    -63302,
    -62997,
    -62672,
    -62328,
    -61965,
    -61583,
    -61183,
    -60763,
    -60326,
    -59870,
    -59395,
    -58903,
    -58393,
    -57864,
    -57319,
    -56755,
    -56175,
    -55577,
    -54963,
    -54331,
    -53683,
    -53019,
    -52339,
    -51643,
    -50931,
    -50203,
    -49460,
    -48702,
    -47929,
    -47142,
    -46340,
    -45525,
    -44695,
    -43852,
    -42995,
    -42125,
    -41243,
    -40347,
    -39440,
    -38521,
    -37589,
    -36647,
    -35693,
    -34728,
    -33753,
    -32768,
    -31772,
    -30767,
    -29752,
    -28729,
    -27696,
    -26655,
    -25606,
    -24550,
    -23486,
    -22414,
    -21336,
    -20251,
    -19160,
    -18064,
    -16961,
    -15854,
    -14742,
    -13625,
    -12504,
    -11380,
    -10252,
    -9120,
    -7986,
    -6850,
    -5711,
    -4571,
    -3429,
    -2287,
    -1143,
    0,
    1143,
    2287,
    3429,
    4571,
    5711,
    6850,
    7986,
    9120,
    10252,
    11380,
    12504,
    13625,
    14742,
    15854,
    16961,
    18064,
    19160,
    20251,
    21336,
    22414,
    23486,
    24550,
    25606,
    26655,
    27696,
    28729,
    29752,
    30767,
    31772,
    32768,
    33753,
    34728,
    35693,
    36647,
    37589,
    38521,
    39440,
    40347,
    41243,
    42125,
    42995,
    43852,
    44695,
    45525,
    46340,
    47142,
    47929,
    48702,
    49460,
    50203,
    50931,
    51643,
    52339,
    53019,
    53683,
    54331,
    54963,
    55577,
    56175,
    56755,
    57319,
    57864,
    58393,
    58903,
    59395,
    59870,
    60326,
    60763,
    61183,
    61583,
    61965,
    62328,
    62672,
    62997,
    63302,
    63589,
    63856,
    64103,
    64331,
    64540,
    64729,
    64898,
    65047,
    65176,
    65286,
    65376,
    65446,
    65496,
    65526,
    65536,
    65526,
    65496,
    65446,
    65376,
    65286,
    65176,
    65047,
    64898,
    64729,
    64540,
    64331,
    64103,
    63856,
    63589,
    63302,
    62997,
    62672,
    62328,
    61965,
    61583,
    61183,
    60763,
    60326,
    59870,
    59395,
    58903,
    58393,
    57864,
    57319,
    56755,
    56175,
    55577,
    54963,
    54331,
    53683,
    53019,
    52339,
    51643,
    50931,
    50203,
    49460,
    48702,
    47929,
    47142,
    46340,
    45525,
    44695,
    43852,
    42995,
    42125,
    41243,
    40347,
    39440,
    38521,
    37589,
    36647,
    35693,
    34728,
    33753,
    32768,
    31772,
    30767,
    29752,
    28729,
    27696,
    26655,
    25606,
    24550,
    23486,
    22414,
    21336,
    20251,
    19160,
    18064,
    16961,
    15854,
    14742,
    13625,
    12504,
    11380,
    10252,
    9120,
    7986,
    6850,
    5711,
    4571,
    3429,
    2287,
    1143
};
